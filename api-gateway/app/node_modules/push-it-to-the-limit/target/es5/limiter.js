"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var r,e=1,i=arguments.length;e<i;e++)for(var n in r=arguments[e])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t},__assign.apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,r,e){if(e||2===arguments.length)for(var i,n=0,s=r.length;n<s;n++)!i&&n in r||(i||(i=Array.prototype.slice.call(r,0,n)),i[n]=r[n]);return t.concat(i||Array.prototype.slice.call(r))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Limiter=void 0;var Limiter=function(){function t(r){return this.limits=r.reduce((function(r,e){return e instanceof t?r.concat(e.limits):__spreadArray(__spreadArray([],r,!0),[__assign(__assign({},e),{rest:e.count,ttl:0})],!1)}),[]),this}return t.prototype.decrease=function(){this.limits.forEach((function(t){t.rest+=-1}))},t.prototype.reset=function(){this.limits.forEach(t.refreshLimit)},t.prototype.resetTtl=function(){this.limits.forEach(t.refreshTtl)},t.prototype.isAllowed=function(){return!this.limits.some((function(t){return t.rest<1}))},t.prototype.getNextDelay=function(){for(var t=0,r=0,e=this.limits;r<e.length;r++){var i=e[r];i.rest<1&&i.ttl>t&&(t=i.ttl)}return t-Date.now()},t.prototype.getNextQueueSize=function(){return Math.min.apply(Math,this.limits.map((function(t){return t.rest})))},t.refreshLimit=function(t){return(void 0===t.ttl||t.ttl<Date.now())&&(t.rest=t.count,t.ttl=Date.now()+t.period),t},t.refreshTtl=function(t){t.ttl=Date.now()+t.period},t}();exports.Limiter=Limiter;