"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InsideOutPromise=exports.factory=void 0;var tslib_1=require("tslib"),bind_decorator_1=require("bind-decorator"),interface_1=require("./interface"),util_1=require("./util");(0,tslib_1.__exportStar)(require("./interface"),exports);var factory=function(e,t){return new InsideOutPromise(e,t)};exports.factory=factory,Object.defineProperty(exports.factory,"Promise",{get:function(){return InsideOutPromise.Promise},set:function(e){(0,util_1.setProto)(InsideOutPromise.prototype,e.prototype),InsideOutPromise.Promise=e}});var InsideOutPromise=function(){function e(t,r){this.state=interface_1.TPromiseState.PENDING;var o=void 0,i=void 0,n=e.normalizeOpts(t,r),s=n.Promise,u=n.executor;return e.contextify(new s((function(e,t){o=e,i=t,u(e,t)})),{state:interface_1.TPromiseState.PENDING,_P:s,_resolve:o,_reject:i})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this.isFulfilled()?this.value:this.isRejected()?this.reason:void 0},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){return this._resolve(e),this},e.prototype.reject=function(e){return this._reject(e),this},e.prototype.then=function(t,r){return e.contextify(this,this,"then",t,r)},e.prototype.catch=function(t){return e.contextify(this,this,"catch",t)},e.prototype.finally=function(t){return this._P.prototype.finally?e.contextify(this,this,"finally",t):this.then(t).catch(t)},e.prototype.isPending=function(){return this.state===interface_1.TPromiseState.PENDING},e.prototype.isFulfilled=function(){return this.state===interface_1.TPromiseState.FULFILLED},e.prototype.isRejected=function(){return this.state===interface_1.TPromiseState.REJECTED},e.prototype.isResolved=function(){return!this.isPending()},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,Symbol.species,{get:function(){return Promise},enumerable:!1,configurable:!0}),Object.defineProperty(e,Symbol.species,{get:function(){return Promise},enumerable:!1,configurable:!0}),Object.defineProperty(e,Symbol.toStringTag,{get:function(){return this.name},enumerable:!1,configurable:!0}),e.contextify=function(e,t,r){for(var o,i=[],n=3;n<arguments.length;n++)i[n-3]=arguments[n];var s=r?(o=t._P.prototype[r]).call.apply(o,(0,tslib_1.__spreadArray)([e],i,!1)):e;return Object.assign((0,util_1.setProto)(this.observe(s),this.prototype),t)},e.observe=function(e){var t=e.then((function(e){return Object.assign(t,{value:e,state:interface_1.TPromiseState.FULFILLED}),e}),(function(e){throw Object.assign(t,{reason:e,state:interface_1.TPromiseState.REJECTED}),e}));return t},e.normalizeOpts=function(t,r){void 0===r&&(r={});var o="function"==typeof t?(0,tslib_1.__assign)((0,tslib_1.__assign)({},r),{executor:t}):t||r;return(0,tslib_1.__assign)({Promise:e.Promise,executor:util_1.noop},o)},e.Promise=Promise,(0,tslib_1.__decorate)([bind_decorator_1.default],e.prototype,"resolve",null),(0,tslib_1.__decorate)([bind_decorator_1.default],e.prototype,"reject",null),e}();exports.InsideOutPromise=InsideOutPromise,exports.factory.Promise=Promise;